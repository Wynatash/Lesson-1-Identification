<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IELTS Reading Interactive Workbook</title>
    <style>
        :root { --primary: #13a62e; --bg: #e5f6e9; --hl-color: #90ee90; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; padding: 0; }
        header { background: var(--primary); color: white; padding: 15px; text-align: center; position: sticky; top: 0; z-index: 1000; }
        .user-status { background: white; padding: 15px; text-align: center; border-bottom: 3px solid var(--primary); position: sticky; top: 60px; z-index: 999; }
        #result-summary { margin-top: 10px; font-weight: bold; color: #d35400; font-size: 1.2rem; display: none; }
        .container { display: grid; grid-template-columns: 300px 1fr; gap: 20px; padding: 20px; max-width: 1700px; margin: auto; }
        .sidebar { background: white; padding: 15px; border-radius: 8px; height: fit-content; position: sticky; top: 180px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); }
        #vocab-display { border: 2px dashed var(--primary); min-height: 100px; padding: 10px; margin: 10px 0; border-radius: 6px; }
        .exercise-block { display: grid; grid-template-columns: 1.2fr 1fr; gap: 30px; background: white; margin-bottom: 30px; padding: 25px; border-radius: 12px; border-bottom: 4px solid #ccc; align-items: start; }
        .reading-section { line-height: 1.8; font-size: 1.1rem; text-align: justify; border-right: 1px solid #eee; padding-right: 20px; }
        .hl-active { background-color: var(--hl-color); cursor: pointer; }
        .options label { display: block; margin: 8px 0; cursor: pointer; }
        .feedback { display: none; font-weight: bold; margin-top: 5px; }
        .explanation { display: none; background: #fff3cd; padding: 10px; margin-top: 10px; border-left: 4px solid #ffc107; font-size: 0.9rem; }
        .btn-submit { background: var(--primary); color: white; border: none; padding: 15px 50px; font-size: 1.2rem; border-radius: 30px; cursor: pointer; display: block; margin: 40px auto; }
        input[type="text"] { padding: 10px; width: 280px; border-radius: 6px; border: 1px solid #ccc; }
        .speaker-btn { background: none; border: none; cursor: pointer; font-size: 1.2rem; vertical-align: middle; padding: 0 5px; }
        .voice-select { width: 100%; padding: 5px; border-radius: 4px; margin-bottom: 10px; border: 1px solid #ccc; font-size: 0.85rem; }
    </style>
</head>
<body>

<header><h1>IELTS READING: IDENTIFICATION ADVANCED</h1></header>

<div class="user-status">
    H·ªç v√† T√™n h·ªçc sinh: <input type="text" id="studentName" placeholder="Nh·∫≠p t√™n c·ªßa b·∫°n...">
    <div id="result-summary"></div>
</div>

<div class="container">
    <div class="sidebar">
        <h4 style="color: var(--primary); margin: 0 0 10px 0;">Selected Vocab</h4>
        <select id="voice-select" class="voice-select">
            <option value="en-US">Gi·ªçng M·ªπ (US Accent)</option>
            <option value="en-GB">Gi·ªçng Anh (UK Accent)</option>
        </select>
        <div id="vocab-display"><i>Nh·∫•p ƒë√∫p v√†o 1 t·ª´ ƒë·ªÉ d·ªãch...</i></div>
        <button onclick="copyVocabList()" style="width: 100%; cursor: pointer; padding: 8px; margin-top: 5px;">Copy Danh s√°ch t·ª´</button>
        <ul id="vocab-history" style="font-size: 0.85rem; padding-left: 20px; margin-top: 15px;"></ul>
    </div>

    <div class="content-area">
        <div class="exercise-block">
            <div class="reading-section">
                <h4 style="color: var(--primary)">European Transport Systems 1990-2010 (1)</h4>
                It is difficult to conceive of vigorous economic growth without an efficient transport system. Although modern information technologies can reduce the demand for physical transport by facilitating teleworking and teleservices, the requirement for transport continues to increase. There are two key factors behind this trend. For passenger transport, the determining factor is the spectacular growth in car use. The number of cars on European Union (EU) roads saw an increase of three million cars each year from 1990 to 2010, and in the next decade the EU will see a further substantial increase in its fleet.
            </div>
            <div class="question-section">
                <div class="q-item" data-ans="T" data-expl="Tr√≠ch: 'Although modern information technologies can reduce the demand... the requirement for transport continues to increase.' -> D·ªãch: M·∫∑c d√π c√¥ng ngh·ªá th√¥ng tin hi·ªán ƒë·∫°i c√≥ th·ªÉ gi·∫£m nhu c·∫ßu... nh∆∞ng y√™u c·∫ßu v·ªÅ v·∫≠n t·∫£i v·∫´n ti·∫øp t·ª•c tƒÉng l√™n.">
                    <p><b>Q1:</b> The need for transport is growing, despite technological developments.</p>
                    <div class="options">
                        <label><input type="radio" name="q1" value="T"> TRUE</label>
                        <label><input type="radio" name="q1" value="F"> FALSE</label>
                        <label><input type="radio" name="q1" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
            </div>
        </div>

        <div class="exercise-block">
            <div class="reading-section">
                <h4 style="color: var(--primary)">European Transport Systems 1990-2010 (2)</h4>
                As far as goods transport is concerned, growth is due to a large extent to changes in the European economy and its system of production. In the last 20 years, as internal frontiers have been abolished, the EU has moved from a ‚Äòstock‚Äô economy to a ‚Äòflow‚Äô economy. This phenomenon has been emphasised by the relocation of some industries, particularly those which are labour intensive, to reduce production costs, even though the production site is hundreds or even thousands of kilometres away from the final assembly plant or away from users.
            </div>
            <div class="question-section">
                <div class="q-item" data-ans="F" data-expl="Tr√≠ch: '...the production site is hundreds or even thousands of kilometres away from the final assembly plant or away from users.' -> D·ªãch: N∆°i s·∫£n xu·∫•t n·∫±m c√°ch xa h√†ng trƒÉm ho·∫∑c th·∫≠m ch√≠ h√†ng ng√†n km so v·ªõi nh√† m√°y l·∫Øp r√°p cu·ªëi c√πng ho·∫∑c c√°ch xa ng∆∞·ªùi d√πng.">
                    <p><b>Q2:</b> To reduce production costs, some industries have been moved closer to their relevant consumers.</p>
                    <div class="options">
                        <label><input type="radio" name="q2" value="T"> TRUE</label>
                        <label><input type="radio" name="q2" value="F"> FALSE</label>
                        <label><input type="radio" name="q2" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
            </div>
        </div>

        <div class="exercise-block">
            <div class="reading-section">
                <h4 style="color: var(--primary)">European Transport Systems 1990-2010 (3)</h4>
                The strong economic growth expected in countries which are candidates for entry to the EU will also increase transport flows, in particular road haulage traffic. In 1998, some of these countries already exported more than twice their 1990 volumes and imported more than five times their 1990 volumes. And although many candidate countries inherited a transport system which encourages rail, the distribution between modes has tipped sharply in favour of road transport since the 1990s. Between 1990 and 1998, road haulage increased by 19.4%, while during the same period rail haulage decreased by 43.5%, although ‚Äì and this could benefit the enlarged EU ‚Äì it is still on average at a much higher level than in existing member states.
            </div>
            <div class="question-section">
                <div class="q-item" data-ans="NG" data-expl="Tr√≠ch: (Kh√¥ng c√≥ th√¥ng tin trong b√†i v·ªÅ gi√° c·∫£ xe h∆°i). -> D·ªãch: B√†i ƒë·ªçc kh√¥ng ƒë·ªÅ c·∫≠p ƒë·∫øn vi·ªác xe h∆°i ƒë·∫Øt ƒë·ªè ·ªü c√°c n∆∞·ªõc ·ª©ng vi√™n.">
                    <p><b>Q3:</b> Cars are prohibitively expensive in some EU candidate countries.</p>
                    <div class="options">
                        <label><input type="radio" name="q3" value="T"> TRUE</label>
                        <label><input type="radio" name="q3" value="F"> FALSE</label>
                        <label><input type="radio" name="q3" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
            </div>
        </div>

        <div class="exercise-block">
            <div class="reading-section">
                <h4 style="color: var(--primary)">European Transport Systems 1990-2010 (4)</h4>
                However, a new imperative-sustainable development ‚Äì offers an opportunity for adapting the EU‚Äôs common transport policy. This objective, agreed by the Gothenburg European Council, has to be achieved by integrating environmental considerations into Community policies, and shifting the balance between modes of transport lies at the heart of its strategy. The ambitious objective can only be fully achieved by 2020, but proposed measures are nonetheless a first essential step towards a sustainable transport system which will ideally be in place in 30 years‚Äô time, that is by 2040.
            </div>
            <div class="question-section">
                <div class="q-item" data-ans="NG" data-expl="Tr√≠ch: '...sustainable transport system which will ideally be in place in 30 years‚Äô time...' -> D·ªãch: H·ªá th·ªëng v·∫≠n t·∫£i b·ªÅn v·ªØng l√Ω t∆∞·ªüng s·∫Ω ƒëi v√†o ho·∫°t ƒë·ªông trong 30 nƒÉm t·ªõi (t√≠nh t·ª´ th·ªùi ƒëi·ªÉm vi·∫øt).">
                    <p><b>Q4:</b> The Gothenburg European Council was set up 30 years ago.</p>
                    <div class="options">
                        <label><input type="radio" name="q4" value="T"> TRUE</label>
                        <label><input type="radio" name="q4" value="F"> FALSE</label>
                        <label><input type="radio" name="q4" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
            </div>
        </div>

        <div class="exercise-block">
            <div class="reading-section">
                <h4 style="color: var(--primary)">European Transport Systems 1990-2010 (5)</h4>
                In 1998, energy consumption in the transport sector was to blame for 28% of emissions of CO2, the leading greenhouse gas. According to the latest estimates, if nothing is done to reverse the traffic growth trend, CO2 emissions from transport can be expected to increase by around 50% to 1,113 billion tonnes by 2020, compared with the 739 billion tonnes recorded in 1990. Once again, road transport is the main culprit since it alone accounts for 84% of the CO2 emissions attributable to transport. Using alternative fuels and improving energy efficiency is thus both an ecological necessity and a technological challenge.
            </div>
            <div class="question-section">
                <div class="q-item" data-ans="F" data-expl="Tr√≠ch: '...increase... to 1,113 billion tonnes by 2020, compared with the 739 billion tonnes recorded in 1990.' -> D·ªãch: L∆∞·ª£ng kh√≠ th·∫£i d·ª± ki·∫øn tƒÉng l√™n 1,113 t·ª∑ t·∫•n v√†o nƒÉm 2020, so v·ªõi con s·ªë 739 t·ª∑ t·∫•n ghi nh·∫≠n nƒÉm 1990.">
                    <p><b>Q5:</b> By the end of this decade, CO2 emissions from transport are predicted to reach 739 billion tonnes.</p>
                    <div class="options">
                        <label><input type="radio" name="q5" value="T"> TRUE</label>
                        <label><input type="radio" name="q5" value="F"> FALSE</label>
                        <label><input type="radio" name="q5" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
            </div>
        </div>

        <div class="exercise-block">
            <div class="reading-section">
                <h4 style="color: var(--primary)">Stepwells</h4>
                Unique to the region, stepwells are often architecturally complex and vary widely in size and shape. During their heyday, they were places of gathering, of leisure, of relaxation and of worship for villagers of all but the lowest castes. Most stepwells are found dotted around the desert areas of Gujarat (where they are called vav) and Rajasthan (where they are known as baori), while a few also survive in Delhi. Some were located in or near villages as public spaces for the community; others were positioned beside roads as resting places for travellers.
                <br><br>As their name suggests, stepwells comprise a series of stone steps descending from ground level to the water source (normally an underground aquifer) as it recedes following the rains. When the water level was high, the user needed only to descend a few steps to reach it; when it was low, several levels would have to be negotiated.
                <br><br>Some wells are vast, open craters with hundreds of steps paving each sloping side, often in tiers. Others are more elaborate, with long stepped passages leading to the water via several storeys. Built from stone and supported by pillars, they also included pavilions that sheltered visitors from the relentless heat. But perhaps the most impressive features are the intricate decorative sculptures that embellish many stepwells, showing activities from fighting and dancing to everyday acts such as women combing their hair and churning butter.
            </div>
            <div class="question-section">
                <div class="q-item" data-ans="T" data-expl="Tr√≠ch: '...they were places of gathering, of leisure, of relaxation and of worship...' -> D·ªãch: Ch√∫ng l√† n∆°i t·ª• h·ªçp, gi·∫£i tr√≠, th∆∞ gi√£n v√† th·ªù c√∫ng.">
                    <p><b>Q6:</b> Stepwells had a range of functions, in addition to those related to water collection.</p>
                    <div class="options">
                        <label><input type="radio" name="q6" value="T"> TRUE</label>
                        <label><input type="radio" name="q6" value="F"> FALSE</label>
                        <label><input type="radio" name="q6" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
                <div class="q-item" data-ans="F" data-expl="Tr√≠ch: 'Unique to the region...' -> D·ªãch: ƒê·∫∑c th√π (Duy nh·∫•t) ƒë·ªëi v·ªõi khu v·ª±c n√†y (kh√¥ng ph·∫£i to√†n th·∫ø gi·ªõi).">
                    <p><b>Q7:</b> Examples of an ancient stepwells can be found all over the world.</p>
                    <div class="options">
                        <label><input type="radio" name="q7" value="T"> TRUE</label>
                        <label><input type="radio" name="q7" value="F"> FALSE</label>
                        <label><input type="radio" name="q7" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
                <div class="q-item" data-ans="NG" data-expl="Tr√≠ch: (Kh√¥ng c√≥ s·ª± so s√°nh v·ªÅ m·ª©c ƒë·ªô h·∫•p d·∫´n). -> D·ªãch: B√†i kh√¥ng so s√°nh v·∫ª ƒë·∫πp c·ªßa gi·∫øng ·ªü Delhi v·ªõi n∆°i kh√°c.">
                    <p><b>Q8:</b> The few existing stepwells in Delhi are more attractive than those found elsewhere.</p>
                    <div class="options">
                        <label><input type="radio" name="q8" value="T"> TRUE</label>
                        <label><input type="radio" name="q8" value="F"> FALSE</label>
                        <label><input type="radio" name="q8" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
                <div class="q-item" data-ans="T" data-expl="Tr√≠ch: '...water source... as it recedes following the rains.' -> D·ªãch: Ngu·ªìn n∆∞·ªõc r√∫t ƒëi sau nh·ªØng c∆°n m∆∞a (l√†m s·ªë b·∫≠c thang thay ƒë·ªïi).">
                    <p><b>Q9:</b> The number of steps above the water level in a stepwell altered during the course of a year.</p>
                    <div class="options">
                        <label><input type="radio" name="q9" value="T"> TRUE</label>
                        <label><input type="radio" name="q9" value="F"> FALSE</label>
                        <label><input type="radio" name="q9" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
                <div class="q-item" data-ans="NG" data-expl="Tr√≠ch: (Kh√¥ng nh·∫Øc ƒë·∫øn th·ªùi gian x√¢y d·ª±ng). -> D·ªãch: B√†i ƒë·ªçc kh√¥ng n√≥i v·ªÅ vi·ªác c√¥ng nh√¢n m·∫•t bao nhi√™u nƒÉm ƒë·ªÉ x√¢y d·ª±ng.">
                    <p><b>Q10:</b> It took workers many years to build the stone steps characteristic of stepwells.</p>
                    <div class="options">
                        <label><input type="radio" name="q10" value="T"> TRUE</label>
                        <label><input type="radio" name="q10" value="F"> FALSE</label>
                        <label><input type="radio" name="q10" value="NG"> NOT GIVEN</label>
                    </div>
                    <div class="feedback"></div><div class="explanation"></div>
                </div>
            </div>
        </div>

        <button type="button" class="btn-submit" onclick="gradeExam()">SUBMIT</button>
    </div>
</div>

<script>
    // Logic Highlight: B√¥i ƒëen ƒë·ªÉ highlight
    document.addEventListener('mouseup', function(e) {
        let sel = window.getSelection();
        let text = sel.toString().trim();
        if (text.length > 0 && (text.includes(' ') || text.length > 15)) {
            let range = sel.getRangeAt(0);
            let span = document.createElement('span');
            span.className = 'hl-active';
            span.ondblclick = function(ev) {
                ev.stopPropagation();
                this.replaceWith(...this.childNodes);
            };
            range.surroundContents(span);
            sel.removeAllRanges();
        }
    });

    // Tra t·ª´ khi nh·∫•p ƒë√∫p (Ch·ªâ t·ª´ ƒë∆°n)
    document.addEventListener('dblclick', function(e) {
        if (e.target.className === 'hl-active' || e.target.className === 'speaker-btn') return; 
        let word = window.getSelection().toString().trim();
        if (word && !word.includes(' ') && word.length < 20) {
            lookupWord(word);
        }
    });

    async function lookupWord(word) {
        const box = document.getElementById('vocab-display');
        const hist = document.getElementById('vocab-history');
        box.innerHTML = "ƒêang tra...";
        try {
            const res = await fetch(`https://api.mymemory.translated.net/get?q=${word}&langpair=en|vi`);
            const data = await res.json();
            const trans = data.responseData.translatedText;
            box.innerHTML = `<strong>${word}</strong>: ${trans} <button class="speaker-btn" onclick="playAudio('${word}')">üîä</button>`;
            hist.innerHTML += `<li><b>${word}</b>: ${trans} <button class="speaker-btn" onclick="playAudio('${word}')">üîä</button></li>`;
        } catch (e) { box.innerHTML = "L·ªói d·ªãch."; }
    }

    function playAudio(text) {
        const accent = document.getElementById('voice-select').value;
        const utter = new SpeechSynthesisUtterance(text);
        utter.lang = accent;
        window.speechSynthesis.speak(utter);
    }

    function gradeExam() {
        const name = document.getElementById('studentName').value.trim();
        if (!name) return alert("Vui l√≤ng nh·∫≠p t√™n!");
        let score = 0;
        const questions = document.querySelectorAll('.q-item');
        questions.forEach(q => {
            const ans = q.getAttribute('data-ans');
            const selected = q.querySelector('input:checked');
            const fb = q.querySelector('.feedback');
            const exp = q.querySelector('.explanation');
            fb.style.display = "block";
            exp.style.display = "block";
            exp.innerHTML = q.getAttribute('data-expl');
            if (selected && selected.value === ans) {
                score++;
                fb.innerHTML = "‚úî ƒê√öNG";
                fb.style.color = "green";
            } else {
                fb.innerHTML = `‚úò SAI (ƒê√°p √°n: ${ans})`;
                fb.style.color = "red";
            }
        });
        const res = document.getElementById('result-summary');
        res.style.display = "block";
        res.innerHTML = `H·ªçc sinh: ${name} . ƒê·∫°t ${score}/${questions.length} c√¢u ƒë√∫ng.`;
        
        // --- PH·∫¶N CODE TH√äM M·ªöI ƒê·ªÇ G·ª¨I D·ªÆ LI·ªÜU ---
        sendToGoogleSheet(name, `${score}/${questions.length}`);
        // ----------------------------------------

        window.scrollTo({top: 0, behavior: 'smooth'});
    }

    function copyVocabList() {
        const text = document.getElementById('vocab-history').innerText;
        navigator.clipboard.writeText(text);
        alert("ƒê√£ l∆∞u danh s√°ch t·ª´ v·ª±ng!");
    }

    // --- FUNCTION TH√äM M·ªöI ƒê·ªÇ K·∫æT N·ªêI GOOGLE SHEETS ---
    function sendToGoogleSheet(studentName, totalScore) {
        const scriptURL = 'https://script.google.com/macros/s/AKfycbyDJ5ORzBODZf_tjLV0ahC7OTuIKVSaf3wasjfjdrCCIC2jNJY1ZQ2z5GADS6wookXP/exec';
        
        // L·∫•y to√†n b·ªô n·ªôi dung HTML ph·∫ßn k·∫øt qu·∫£ (bao g·ªìm feedback v√† gi·∫£i th√≠ch)
        const detailedContent = document.querySelector('.content-area').innerHTML;

        const data = {
            studentName: studentName,
            totalScore: totalScore,
            detailedAnswers: detailedContent
        };

        fetch(scriptURL, {
            method: 'POST',
            mode: 'no-cors', // S·ª≠ d·ª•ng no-cors ƒë·ªÉ tr√°nh l·ªói ch√≠nh s√°ch b·∫£o m·∫≠t tr√¨nh duy·ªát
            cache: 'no-cache',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(data)
        })
        .then(() => {
            alert("N·ªôp b√†i th√†nh c√¥ng!");
        })
        .catch(error => {
            console.error('Error!', error.message);
            alert("N·ªôp b√†i kh√¥ng th√†nh c√¥ng, vui l√≤ng th·ª≠ l·∫°i.");
        });
    }
    // ------------------------------------------------
</script>
</body>
</html>